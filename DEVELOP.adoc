= 开发设计文档
:experimental:
:icons: font
:toc: right
:toc-title: 目录
:toclevels: 4
:source-highlighter: rouge

==  整体架构

整个项目分为如下几个模块

== 实现细节

== 工作流程

[source,bash]
----
pkg build --target centos_7 --runtime podman --var arch=amd64 --profile prod  group01#package

----

. *准备和校验所有的配置文件*
** *拉取所有远程配置*：将所有远程声明的配置拉取到本地缓冲区
** *检查语法错误*：加载工程内的所有配置文件到内存中，同时校验相关 YAML 语法错误和依赖导入关系错误
** *合并导入*：将存在导入关系的配置合并成一份配置
. *创建工作空间*：根据 *target* 和 *runtime* 创建工作空间，在工作空间内可创建大量任务，并收集任务的输入和输出
. *建立编译工作流*
** *生成包关系有向无环图*：为需要编译的包建立有向无环图，排除循环依赖
** *对比包版本*：从 *工作空间* 启动空白的 *target环境* 查询所有包的版本信息，如果存在包冲突（*target环境* 远程源下存在相同名称的包）则对比其版本，如果版本符合依赖的要求则使用远程源的包，否则使用工程内提供的包并将其加入编译任务，如果所有版本均不匹配则结束编译流程。
** *精简编译关系*：针对已经编译完成的项目则去除相关的 *编译依赖* ，仅保留 *安装依赖*
. *准备资源*
** *下载相关资源*：根据配置定义，下载并校验所有定义的 *source*，如果存在本地缓存则优先使用本地缓存。
** *渲染编译配置*：将 *target环境* 定义的编译相关文档渲染到目标位置
